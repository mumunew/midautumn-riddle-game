# 中秋猜谜语游戏 - 技术说明文档

## 项目概述

中秋猜谜语游戏是一个基于Web的在线猜谜游戏，以中秋节为主题，用户可以通过输入用户名参与游戏，猜解灯谜并查看实时排行榜。项目采用前后端分离架构，前端使用原生HTML/CSS/JavaScript，后端使用Supabase作为数据库服务。

## 技术架构

### 整体架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端界面      │    │   Vercel部署    │    │   Supabase      │
│  (HTML/CSS/JS)  │◄──►│   (静态托管)    │◄──►│   (数据库)      │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

### 技术栈

#### 前端技术
- **HTML5**: 页面结构和语义化标记
- **CSS3**: 样式设计，包括动画效果和响应式布局
- **JavaScript (ES6+)**: 游戏逻辑和用户交互
- **Supabase JavaScript SDK**: 数据库操作客户端

#### 后端服务
- **Supabase**: 
  - PostgreSQL数据库
  - 实时数据同步
  - 用户认证（可选）
  - RESTful API

#### 部署平台
- **Vercel**: 
  - 静态网站托管
  - Serverless Functions
  - 环境变量管理
  - 自动部署

## 项目结构

```
024中秋猜谜语简单版/
├── index.html              # 主页面文件
├── riddles.js              # 谜题数据文件
├── vercel.json             # Vercel部署配置
├── .gitignore              # Git忽略文件配置
├── README.md               # 项目说明
├── 需求说明.txt            # 详细需求文档
├── Supabase配置指南.md     # 数据库配置指南
├── 安全配置指南.md         # 安全配置说明
├── 技术说明文档.md         # 本文档
└── api/                    # API接口目录（Serverless Functions）
    └── config.js           # 配置获取接口
```

## 核心功能模块

### 1. 用户认证模块
- **功能**: 用户名输入和验证
- **实现**: 
  - 前端表单验证
  - 用户名唯一性检查
  - 本地存储用户状态
- **技术要点**: 
  - 使用localStorage保存用户信息
  - 实时验证用户名重复性

### 2. 游戏核心模块
- **功能**: 谜题展示、答案提交、得分计算
- **实现**:
  - 随机谜题选择算法
  - 答案匹配逻辑（支持模糊匹配）
  - 计分系统
- **技术要点**:
  - 谜题数据存储在riddles.js中（118道谜题）
  - 支持多种谜题类型：传统谜语、脑筋急转弯、字谜等

### 3. 排行榜模块
- **功能**: 实时排行榜显示
- **实现**:
  - Supabase实时数据同步
  - 排序算法（按得分和时间排序）
- **技术要点**:
  - 使用Supabase的实时订阅功能
  - 自动更新排行榜数据

### 4. 界面交互模块
- **功能**: 响应式UI、动画效果、用户体验优化
- **实现**:
  - CSS3动画和过渡效果
  - 移动端适配
  - 灯笼主题设计
- **技术要点**:
  - 渐变背景动画
  - 浮动和脉冲动画效果
  - Flexbox和Grid布局

## 数据库设计

### 用户表 (users)
```sql
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    score INTEGER DEFAULT 0,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### 游戏记录表 (game_records)
```sql
CREATE TABLE game_records (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    riddle_id INTEGER,
    answer TEXT,
    is_correct BOOLEAN,
    created_at TIMESTAMP DEFAULT NOW()
);
```

## 安全配置

### 环境变量管理
- **开发环境**: 使用本地config.js文件（已加入.gitignore）
- **生产环境**: 使用Vercel环境变量
  - `SUPABASE_URL`: Supabase项目URL
  - `SUPABASE_ANON_KEY`: Supabase匿名访问密钥

### 安全措施
1. **前端安全**:
   - 不在前端代码中硬编码敏感信息
   - 使用环境变量管理配置
   - 输入验证和XSS防护

2. **后端安全**:
   - Supabase行级安全策略(RLS)
   - API访问限制
   - 数据验证和清理

## 部署配置

### Vercel配置 (vercel.json)
```json
{
  "functions": {
    "api/config.js": {
      "runtime": "nodejs18.x"
    }
  },
  "rewrites": [
    {
      "source": "/api/config",
      "destination": "/api/config.js"
    }
  ],
  "env": {
    "SUPABASE_URL": "@supabase-url",
    "SUPABASE_ANON_KEY": "@supabase-anon-key"
  }
}
```

### 部署流程
1. **代码提交**: 推送到GitHub仓库
2. **自动构建**: Vercel自动检测更改并构建
3. **环境变量**: 自动注入生产环境变量
4. **静态部署**: 部署到全球CDN网络

## 性能优化

### 前端优化
- **资源优化**:
  - CSS和JavaScript内联，减少HTTP请求
  - 图片使用SVG格式，支持矢量缩放
  - 字体使用系统字体栈

- **加载优化**:
  - 关键CSS内联
  - JavaScript异步加载
  - 懒加载非关键资源

### 数据库优化
- **查询优化**:
  - 使用索引优化排行榜查询
  - 限制查询结果数量
  - 使用Supabase的缓存机制

## 浏览器兼容性

### 支持的浏览器
- Chrome 60+
- Firefox 55+
- Safari 12+
- Edge 79+
- 移动端浏览器

### 关键特性支持
- CSS Grid和Flexbox
- ES6+ JavaScript特性
- WebSocket (Supabase实时功能)
- LocalStorage

## 开发和维护

### 本地开发环境搭建
1. 克隆项目仓库
2. 配置Supabase连接信息
3. 启动本地HTTP服务器
4. 访问localhost进行开发测试

### 代码规范
- **HTML**: 语义化标签，无障碍访问
- **CSS**: BEM命名规范，模块化样式
- **JavaScript**: ES6+语法，函数式编程

### 测试策略
- **功能测试**: 手动测试各功能模块
- **兼容性测试**: 多浏览器测试
- **性能测试**: 页面加载速度和响应时间
- **安全测试**: 输入验证和XSS防护

## 扩展功能建议

### 短期扩展
1. **用户系统增强**:
   - 用户头像上传
   - 个人统计信息
   - 成就系统

2. **游戏功能扩展**:
   - 难度分级
   - 时间限制模式
   - 多人对战模式

### 长期扩展
1. **社交功能**:
   - 好友系统
   - 分享功能
   - 评论和点赞

2. **管理后台**:
   - 谜题管理
   - 用户管理
   - 数据统计

## 技术债务和改进点

### 当前限制
1. **前端架构**: 使用原生JavaScript，缺乏组件化
2. **状态管理**: 使用全局变量，缺乏统一状态管理
3. **错误处理**: 错误处理机制不够完善
4. **测试覆盖**: 缺乏自动化测试

### 改进建议
1. **框架升级**: 考虑使用React或Vue.js重构
2. **状态管理**: 引入Redux或Vuex
3. **测试框架**: 添加Jest或Cypress测试
4. **CI/CD**: 完善持续集成和部署流程

## 联系信息

- **项目维护者**: [维护者姓名]
- **技术支持**: [支持邮箱]
- **项目仓库**: [GitHub仓库地址]

---

*最后更新时间: 2024年1月*
*文档版本: v1.0*